---
import Layout from '../layouts/Layout.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import Button from '../components/Button.astro';

interface Command {
  name: string;
  phase: string;
  description: string;
  usage: string;
  example: string;
  related: string[];
}

const commands: Command[] = [
  {
    name: '/q0-init',
    phase: 'Setup',
    description: 'Initialize .quint/ and record the Bounded Context.',
    usage: '/q0-init',
    example: 'Run this once at the start of a new project or when starting a new decision cycle.',
    related: ['/q1-hypothesize'],
  },
  {
    name: '/q1-hypothesize',
    phase: 'Abduction',
    description: 'Generate L0 hypotheses for a problem.',
    usage: '/q1-hypothesize "problem description"',
    example: '/q1-hypothesize "How should we handle cross-service transactions?"',
    related: ['/q1-add', '/q2-verify'],
  },
  {
    name: '/q1-add',
    phase: 'Abduction',
    description: 'Manually add your own L0 hypothesis.',
    usage: '/q1-add "hypothesis description"',
    example: '/q1-add "Use Saga pattern with orchestrator"',
    related: ['/q1-hypothesize', '/q2-verify'],
  },
  {
    name: '/q2-verify',
    phase: 'Deduction',
    description: 'Verify logic and constraints, promoting claims from L0 to L1.',
    usage: '/q2-verify [hypothesis-id]',
    example: '/q2-verify H1',
    related: ['/q1-hypothesize', '/q3-validate'],
  },
  {
    name: '/q3-validate',
    phase: 'Induction',
    description: 'Gather empirical evidence, promoting claims from L1 to L2.',
    usage: '/q3-validate [hypothesis-id]',
    example: '/q3-validate H2',
    related: ['/q2-verify', '/q4-audit'],
  },
  {
    name: '/q4-audit',
    phase: 'Audit',
    description: 'Run an assurance audit and calculate trust scores.',
    usage: '/q4-audit',
    example: 'Automatically analyzes all hypotheses in the current cycle.',
    related: ['/q3-validate', '/q5-decide'],
  },
  {
    name: '/q5-decide',
    phase: 'Decision',
    description: 'Select the winning hypothesis and create a Design Rationale Record.',
    usage: '/q5-decide [hypothesis-id]',
    example: '/q5-decide H2',
    related: ['/q4-audit', '/q-query'],
  },
  {
    name: '/q-status',
    phase: 'Utility',
    description: 'Show the current state of the reasoning cycle.',
    usage: '/q-status',
    example: 'Run anytime to see where you are in the decision process.',
    related: [],
  },
  {
    name: '/q-query',
    phase: 'Utility',
    description: "Search the project's knowledge base.",
    usage: '/q-query "search term"',
    example: '/q-query "authentication"',
    related: ['/q-decay'],
  },
  {
    name: '/q-decay',
    phase: 'Utility',
    description: 'Check for and report expired evidence (Epistemic Debt).',
    usage: '/q-decay',
    example: 'Flags evidence older than configured threshold.',
    related: ['/q-query', '/q-actualize'],
  },
  {
    name: '/q-actualize',
    phase: 'Utility',
    description: 'Reconcile the knowledge base with recent code changes.',
    usage: '/q-actualize',
    example: 'Run after significant code changes to update the knowledge base.',
    related: ['/q-decay', '/q-query'],
  },
  {
    name: '/q-reset',
    phase: 'Utility',
    description: 'Discard the current reasoning cycle.',
    usage: '/q-reset',
    example: 'Use when you want to start fresh without completing the current cycle.',
    related: ['/q0-init'],
  },
];

const phaseColors: Record<string, string> = {
  'Setup': 'text-text-muted',
  'Abduction': 'text-accent-green',
  'Deduction': 'text-accent-blue',
  'Induction': 'text-accent-purple',
  'Audit': 'text-accent-green',
  'Decision': 'text-accent-blue',
  'Utility': 'text-text-muted',
};
---

<Layout title="Command Reference" description="Complete reference for all quint-code commands with usage examples.">
  <Header />

  <main class="flex-1">
    <!-- Hero -->
    <section class="border-b border-border-subtle py-16">
      <div class="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8">
        <h1 class="text-4xl font-bold text-text-primary sm:text-5xl">
          Command Reference
        </h1>
        <p class="mt-4 text-xl text-text-secondary">
          Quick reference for all quint-code commands.
        </p>
      </div>
    </section>

    <!-- Quick Reference Table -->
    <section class="py-16">
      <div class="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8">
        <h2 class="text-2xl font-bold text-text-primary">Quick Reference</h2>

        <div class="mt-8 overflow-x-auto">
          <table class="w-full text-left text-sm">
            <thead>
              <tr class="border-b border-border-subtle">
                <th class="pb-4 pr-4 font-mono font-semibold text-text-primary">Command</th>
                <th class="pb-4 pr-4 font-semibold text-text-muted">Phase</th>
                <th class="pb-4 font-semibold text-text-muted">Description</th>
              </tr>
            </thead>
            <tbody class="divide-y divide-border-subtle">
              {commands.map((cmd) => (
                <tr class="group">
                  <td class="py-4 pr-4">
                    <a
                      href={`#${cmd.name.replace('/', '')}`}
                      class="font-mono text-accent-green hover:underline"
                    >
                      {cmd.name}
                    </a>
                  </td>
                  <td class={`py-4 pr-4 ${phaseColors[cmd.phase]}`}>
                    {cmd.phase}
                  </td>
                  <td class="py-4 text-text-secondary">
                    {cmd.description.split('.')[0]}.
                  </td>
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      </div>
    </section>

    <!-- Detailed Reference -->
    <section class="border-t border-border-subtle bg-bg-secondary/50 py-16">
      <div class="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8">
        <h2 class="text-2xl font-bold text-text-primary">Detailed Reference</h2>

        <div class="mt-8 space-y-8">
          {commands.map((cmd) => (
            <div
              id={cmd.name.replace('/', '')}
              class="scroll-mt-24 rounded-lg border border-border-subtle bg-bg-secondary p-6"
            >
              <div class="flex flex-wrap items-center gap-3">
                <h3 class="font-mono text-xl font-bold text-text-primary">
                  {cmd.name}
                </h3>
                <span class={`rounded-full px-2 py-0.5 text-xs ${phaseColors[cmd.phase]} bg-bg-tertiary`}>
                  {cmd.phase}
                </span>
              </div>

              <p class="mt-4 text-text-secondary">{cmd.description}</p>

              <div class="mt-6 space-y-4">
                <div>
                  <h4 class="text-sm font-semibold text-text-muted">Usage</h4>
                  <code class="mt-1 block rounded bg-bg-primary px-3 py-2 font-mono text-sm text-accent-green">
                    {cmd.usage}
                  </code>
                </div>

                <div>
                  <h4 class="text-sm font-semibold text-text-muted">Example</h4>
                  <p class="mt-1 text-sm text-text-secondary">{cmd.example}</p>
                </div>

                {cmd.related.length > 0 && (
                  <div>
                    <h4 class="text-sm font-semibold text-text-muted">Related Commands</h4>
                    <div class="mt-1 flex flex-wrap gap-2">
                      {cmd.related.map((rel) => (
                        <a
                          href={`#${rel.replace('/', '')}`}
                          class="rounded bg-bg-tertiary px-2 py-1 font-mono text-xs text-text-secondary hover:text-text-primary"
                        >
                          {rel}
                        </a>
                      ))}
                    </div>
                  </div>
                )}
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>

    <!-- CTA -->
    <section class="border-t border-border-subtle py-16">
      <div class="mx-auto max-w-4xl px-4 sm:px-6 lg:px-8 text-center">
        <h2 class="text-2xl font-bold text-text-primary">Need more details?</h2>
        <p class="mt-4 text-text-secondary">
          Check out the full documentation on GitHub or see the ADI cycle in action.
        </p>

        <div class="mt-8 flex flex-wrap justify-center gap-4">
          <Button href="/learn">Learn the ADI Cycle</Button>
          <Button href="https://github.com/m0n0x41d/quint-code" variant="secondary" external>
            GitHub Docs
          </Button>
        </div>
      </div>
    </section>
  </main>

  <Footer />
</Layout>
